<?php $__env->startSection('content'); ?>
<?php echo $__env->make('site.partials.header_top', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<div class="full-width cart-view">
  <div class="row">
    <div class="medium-12 columns">
      <h3>Your Cart</h3>
      <table width="100%" class="cart-table">
        <tr>
          <th>Product</th>
          <th>Qty</th>
          <th>PRICE</th>
          <th width="80">NOS</th>
          <th>SUBTOTAL</th>
        </tr>
        <?php foreach($cart as $item): ?>
        <tr>
          <td><?php echo e($item->name); ?>

              <a href="#" class="danger link-anchor" data-url="cart/remove/<?php echo e($item->rowid); ?>" data-method="get">remove</a>
          </td>
          <td><?php echo e($item->options->pqty); ?><?php echo e($item->options->pqunit); ?></td>
          <td><?php echo e($item->price); ?></td>
          <td><input type="number" value="<?php echo e($item->qty); ?>" class="pnos" data-rid="<?php echo e($item->rowid); ?>" min="1"/></td>
          <td><?php echo e($item->subtotal); ?></td>
        </tr>
        <?php endforeach; ?>
        
      </table>
      <p class="text-right">TOTAL:  Rs. <?php echo e($total); ?> /-</p>
      <div class="row">
        <div class="medium-6 columns">
          Ship To: Address
          <p>
            <?php if(isset($user->address)): ?>
              <?php echo e($user->address); ?>

            <?php else: ?>
              <button class="button tiny">Add Address</button>
            <?php endif; ?>
          </p>
        </div>
        <div class="medium-6 columns">
          <p class="text-right">
            <a href="/" class="button success">Shop More</a>
            <a href="cart/checkout" class="button primary">Place Order</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<?php echo $__env->make('site.partials.footer_middle', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('page-modal'); ?>

<?php $__env->stopSection(); ?>

<?php $__env->startSection('scriptsContent'); ?>
  <script type="text/javascript">
  //change the price based on quantity select
   $(".quantity-price").on('change', function(){
    var opt = $(this).find('option:selected');
    var price = opt.data('qprice');
    console.log(price);
    var clo = $(this).parents('.quantity-wrapper').find('.qty-price');
    clo.html('<span class="price-num">&#8377;'+ price+'</span>')
   });
   $(".quantity-price").trigger('change');

   //update cart nos
   $('input.pnos').on('change', function(){
    var rid = $(this).data('rid');
    var nos = $(this).val();
    var postData = {};
    postData['nos'] = nos;
    postData['id'] = rid;
    console.log(rid);
    $.when(http_post('cart/updateNos', postData)).then(function(response){
      location.reload();
    }, function(response){
      console.log('cart update failed');
    })
   });

  </script>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('site/master', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>